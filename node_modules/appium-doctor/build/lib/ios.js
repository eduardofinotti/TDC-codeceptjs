"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.OptionalIOSWebkitDebugProxyCommandCheck = exports.OptionalIOSDeployCommandCheck = exports.OptionalIdevicelocationCommandCheck = exports.OptionalApplesimutilsCommandCheck = exports.OptionalFbsimctlCommandCheck = exports.CarthageCheck = exports.AuthorizationDbCheck = exports.DevToolsSecurityCheck = exports.XcodeCmdLineToolsCheck = exports.XcodeCheck = exports.fixes = void 0;

require("source-map-support/register");

var _utils = require("./utils");

var _appiumSupport = require("appium-support");

var _teen_process = require("teen_process");

var _doctor = require("./doctor");

var _logger = _interopRequireDefault(require("./logger"));

var _carthageDetector = _interopRequireDefault(require("./carthage-detector"));

var _prompt = require("./prompt");

var _env = _interopRequireDefault(require("./env"));

var _os = require("os");

let checks = [];
let fixes = {};
exports.fixes = fixes;

class XcodeCheck extends _doctor.DoctorCheck {
  async diagnose() {
    let xcodePath;

    try {
      await (0, _teen_process.exec)('xcrun', ['simctl', 'help']);
      const {
        stdout
      } = await (0, _teen_process.exec)('xcode-select', ['-p']);
      xcodePath = (stdout || '').replace('\n', '');
    } catch (err) {
      return (0, _utils.nok)('Xcode is NOT installed!');
    }

    return xcodePath && (await _appiumSupport.fs.exists(xcodePath)) ? (0, _utils.ok)(`Xcode is installed at: ${xcodePath}`) : (0, _utils.nok)(`Xcode cannot be found at '${xcodePath}'!`);
  }

  async fix() {
    return "Manually install Xcode, and make sure 'xcode-select -p' command shows proper path like '/Applications/Xcode.app/Contents/Developer'";
  }

}

exports.XcodeCheck = XcodeCheck;
checks.push(new XcodeCheck());

class XcodeCmdLineToolsCheck extends _doctor.DoctorCheck {
  constructor() {
    super({
      autofix: true
    });
  }

  async diagnose() {
    const errMess = 'Xcode Command Line Tools are NOT installed!';

    try {
      const stdout = (await (0, _teen_process.exec)('xcode-select', ['-p'])).stdout;
      return (0, _utils.ok)(`Xcode Command Line Tools are installed in: ${stdout.trim()}`);
    } catch (err) {
      _logger.default.debug(err);

      return (0, _utils.nok)(errMess);
    }
  }

  async fix() {
    _logger.default.info(`The following command need be executed: xcode-select --install`);

    let yesno = await (0, _prompt.fixIt)();

    if (yesno === 'yes') {
      await (0, _teen_process.exec)('xcode-select', ['--install']);
    } else {
      _logger.default.info('Skipping you will need to install Xcode manually.');

      throw new _doctor.FixSkippedError();
    }
  }

}

exports.XcodeCmdLineToolsCheck = XcodeCmdLineToolsCheck;
checks.push(new XcodeCmdLineToolsCheck());

fixes.authorizeIosFix = async function () {
  _logger.default.info(`The authorize iOS script need to be run.`);

  let yesno = await (0, _prompt.fixIt)();

  if (yesno === 'yes') {
    await (0, _utils.authorizeIos)();
  } else {
    _logger.default.info('Skipping you will need to run the authorize iOS manually.');

    throw new _doctor.FixSkippedError();
  }
};

class DevToolsSecurityCheck extends _doctor.DoctorCheck {
  constructor() {
    super({
      autofix: true
    });
  }

  async diagnose() {
    const errMess = 'DevToolsSecurity is NOT enabled!';
    let stdout;

    try {
      stdout = (await (0, _teen_process.exec)('DevToolsSecurity', [])).stdout;
    } catch (err) {
      _logger.default.debug(err);

      return (0, _utils.nok)(errMess);
    }

    return stdout && stdout.match(/enabled/) ? (0, _utils.ok)('DevToolsSecurity is enabled.') : (0, _utils.nok)(errMess);
  }

  async fix() {
    return await fixes.authorizeIosFix();
  }

}

exports.DevToolsSecurityCheck = DevToolsSecurityCheck;
checks.push(new DevToolsSecurityCheck());

class AuthorizationDbCheck extends _doctor.DoctorCheck {
  constructor() {
    super({
      autofix: true
    });
  }

  async diagnose() {
    const successMess = 'The Authorization DB is set up properly.';
    const errMess = 'The Authorization DB is NOT set up properly.';
    let stdout;

    try {
      ({
        stdout
      } = await (0, _teen_process.exec)('security', ['authorizationdb', 'read', 'system.privilege.taskport']));
    } catch (err) {
      _logger.default.warn(err);

      return (0, _utils.nok)(errMess);
    }

    return stdout && (stdout.match(/is-developer/) || stdout.match(/allow/)) ? (0, _utils.ok)(successMess) : (0, _utils.nok)(errMess);
  }

  async fix() {
    return await fixes.authorizeIosFix();
  }

}

exports.AuthorizationDbCheck = AuthorizationDbCheck;
checks.push(new AuthorizationDbCheck());

class CarthageCheck extends _doctor.DoctorCheck {
  async diagnose() {
    let carthagePath = await _carthageDetector.default.detect();
    return carthagePath ? (0, _utils.ok)(`Carthage was found at: ${carthagePath}`) : (0, _utils.nok)(`Carthage was NOT found!`);
  }

  async fix() {
    return 'Please install Carthage. Visit https://github.com/Carthage' + '/Carthage#installing-carthage for more information.';
  }

}

exports.CarthageCheck = CarthageCheck;
checks.push(new CarthageCheck());
checks.push(new _env.default('HOME'));

class OptionalFbsimctlCommandCheck extends _doctor.DoctorCheck {
  async diagnose() {
    const fbsimctlPath = await (0, _utils.resolveExecutablePath)('fbsimctl');

    if (fbsimctlPath) {
      try {
        const fbsimctlVersion = (await (0, _teen_process.exec)('brew', ['list', '--versions', 'fbsimctl'])).stdout.trim();
        return (0, _utils.okOptional)(`fbsimctl is installed at: ${fbsimctlPath}. Installed versions are: ${fbsimctlVersion}`);
      } catch (_unused) {
        return (0, _utils.okOptional)(`fbsimctl is installed at: ${fbsimctlPath}. It is prbably installed as custom install.`);
      }
    }

    return (0, _utils.nokOptional)('fbsimctl cannot be found');
  }

  async fix() {
    return 'Why fbsimctl is needed and how to install it: http://appium.io/docs/en/drivers/ios-xcuitest/';
  }

}

exports.OptionalFbsimctlCommandCheck = OptionalFbsimctlCommandCheck;
checks.push(new OptionalFbsimctlCommandCheck());

class OptionalApplesimutilsCommandCheck extends _doctor.DoctorCheck {
  async diagnose() {
    const applesimutilsPath = await (0, _utils.resolveExecutablePath)('applesimutils');
    return applesimutilsPath ? (0, _utils.okOptional)(`applesimutils is installed at: ${applesimutilsPath}. Installed versions are: ${(await (0, _teen_process.exec)('brew', ['list', '--versions', 'applesimutils'])).stdout.trim()}`) : (0, _utils.nokOptional)('applesimutils cannot be found');
  }

  async fix() {
    return 'Why applesimutils is needed and how to install it: http://appium.io/docs/en/drivers/ios-xcuitest/';
  }

}

exports.OptionalApplesimutilsCommandCheck = OptionalApplesimutilsCommandCheck;
checks.push(new OptionalApplesimutilsCommandCheck());

class OptionalIdevicelocationCommandCheck extends _doctor.DoctorCheck {
  async diagnose() {
    const idevicelocationPath = await (0, _utils.resolveExecutablePath)('idevicelocation');
    return idevicelocationPath ? (0, _utils.okOptional)(`idevicelocation is installed at: ${idevicelocationPath}`) : (0, _utils.nokOptional)('idevicelocation cannot be found');
  }

  async fix() {
    return 'idevicelocation is used to set geolocation for real device. Please read https://github.com/JonGabilondoAngulo/idevicelocation to install it';
  }

}

exports.OptionalIdevicelocationCommandCheck = OptionalIdevicelocationCommandCheck;
checks.push(new OptionalIdevicelocationCommandCheck());

class OptionalIOSDeployCommandCheck extends _doctor.DoctorCheck {
  async diagnose() {
    const iosDeployPath = await (0, _utils.resolveExecutablePath)('ios-deploy');
    return iosDeployPath ? (0, _utils.okOptional)(`ios-deploy is installed at: ${iosDeployPath}. Installed version is: ${(await (0, _teen_process.exec)(iosDeployPath, ['-V'])).stdout.trim()}`) : (0, _utils.nokOptional)('ios-deploy cannot be found');
  }

  async fix() {
    return 'ios-deploy is used to install iOS applications to real device. Please read http://appium.io/docs/en/drivers/ios-xcuitest-real-devices/ to install it';
  }

}

exports.OptionalIOSDeployCommandCheck = OptionalIOSDeployCommandCheck;
checks.push(new OptionalIOSDeployCommandCheck());

class OptionalIOSWebkitDebugProxyCommandCheck extends _doctor.DoctorCheck {
  async diagnose() {
    const iosWebkitDebugProxyPath = await (0, _utils.resolveExecutablePath)('ios_webkit_debug_proxy');

    if (iosWebkitDebugProxyPath) {
      const version = (await (0, _teen_process.exec)(iosWebkitDebugProxyPath, ['-V'])).stdout.split(_os.EOL);
      return (0, _utils.okOptional)(`ios_webkit_debug_proxy is installed at: ${iosWebkitDebugProxyPath}. Installed version is: ${version[0].replace('ios_webkit_debug_proxy ', '')}, ${version[1]}`);
    }

    return (0, _utils.nokOptional)('ios_webkit_debug_proxy cannot be found');
  }

  async fix() {
    return 'ios_webkit_debug_proxy is used to proxy requets from Appium to MobileSafari running on real device. Please read https://github.com/google/ios-webkit-debug-proxy to install it';
  }

}

exports.OptionalIOSWebkitDebugProxyCommandCheck = OptionalIOSWebkitDebugProxyCommandCheck;
checks.push(new OptionalIOSWebkitDebugProxyCommandCheck());
var _default = checks;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9pb3MuanMiXSwibmFtZXMiOlsiY2hlY2tzIiwiZml4ZXMiLCJYY29kZUNoZWNrIiwiRG9jdG9yQ2hlY2siLCJkaWFnbm9zZSIsInhjb2RlUGF0aCIsInN0ZG91dCIsInJlcGxhY2UiLCJlcnIiLCJmcyIsImV4aXN0cyIsImZpeCIsInB1c2giLCJYY29kZUNtZExpbmVUb29sc0NoZWNrIiwiY29uc3RydWN0b3IiLCJhdXRvZml4IiwiZXJyTWVzcyIsInRyaW0iLCJsb2ciLCJkZWJ1ZyIsImluZm8iLCJ5ZXNubyIsIkZpeFNraXBwZWRFcnJvciIsImF1dGhvcml6ZUlvc0ZpeCIsIkRldlRvb2xzU2VjdXJpdHlDaGVjayIsIm1hdGNoIiwiQXV0aG9yaXphdGlvbkRiQ2hlY2siLCJzdWNjZXNzTWVzcyIsIndhcm4iLCJDYXJ0aGFnZUNoZWNrIiwiY2FydGhhZ2VQYXRoIiwiQ2FydGhhZ2VEZXRlY3RvciIsImRldGVjdCIsIkVudlZhckFuZFBhdGhDaGVjayIsIk9wdGlvbmFsRmJzaW1jdGxDb21tYW5kQ2hlY2siLCJmYnNpbWN0bFBhdGgiLCJmYnNpbWN0bFZlcnNpb24iLCJPcHRpb25hbEFwcGxlc2ltdXRpbHNDb21tYW5kQ2hlY2siLCJhcHBsZXNpbXV0aWxzUGF0aCIsIk9wdGlvbmFsSWRldmljZWxvY2F0aW9uQ29tbWFuZENoZWNrIiwiaWRldmljZWxvY2F0aW9uUGF0aCIsIk9wdGlvbmFsSU9TRGVwbG95Q29tbWFuZENoZWNrIiwiaW9zRGVwbG95UGF0aCIsIk9wdGlvbmFsSU9TV2Via2l0RGVidWdQcm94eUNvbW1hbmRDaGVjayIsImlvc1dlYmtpdERlYnVnUHJveHlQYXRoIiwidmVyc2lvbiIsInNwbGl0IiwiRU9MIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUdBLElBQUlBLE1BQU0sR0FBRyxFQUFiO0FBQ0EsSUFBSUMsS0FBSyxHQUFHLEVB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Q0EsV0FBT0EsYUFBYSxHQUNoQix1QkFBWSwrQkFBOEJBLGFBQWMsMkJBQTBCLENBQUMsTUFBTSx3QkFBS0EsYUFBTCxFQUFvQixDQUFDLElBQUQsQ0FBcEIsQ0FBUCxFQUFvQ3BDLE1BQXBDLENBQTJDVyxJQUEzQyxFQUFrRCxFQUFwSSxDQURnQixHQUVoQix3QkFBWSw0QkFBWixDQUZKO0FBR0Q7O0FBRUQsUUFBTU4sR0FBTixHQUFhO0FBQ1gsV0FBTyxzSkFBUDtBQUNEOztBQVZxRDs7O0FBWXhEWCxNQUFNLENBQUNZLElBQVAsQ0FBWSxJQUFJNkIsNkJBQUosRUFBWjs7QUFFQSxNQUFNRSx1Q0FBTixTQUFzRHhDLG1CQUF0RCxDQUFrRTtBQUNoRSxRQUFNQyxRQUFOLEdBQWtCO0FBQ2hCLFVBQU13Qyx1QkFBdUIsR0FBRyxNQUFNLGtDQUFzQix3QkFBdEIsQ0FBdEM7O0FBQ0EsUUFBSUEsdUJBQUosRUFBNkI7QUFDM0IsWUFBTUMsT0FBTyxHQUFHLENBQUMsTUFBTSx3QkFBS0QsdUJBQUwsRUFBOEIsQ0FBQyxJQUFELENBQTlCLENBQVAsRUFBOEN0QyxNQUE5QyxDQUFxRHdDLEtBQXJELENBQTJEQyxPQUEzRCxDQUFoQjtBQUNBLGFBQU8sdUJBQVksMkNBQTBDSCx1QkFBd0IsMkJBQ25GQyxPQUFPLENBQUMsQ0FBRCxDQUFQLENBQVd0QyxPQUFYLENBQW1CLHlCQUFuQixFQUE4QyxFQUE5QyxDQUFrRCxLQUFJc0MsT0FBTyxDQUFDLENBQUQsQ0FBSSxFQUQ1RCxDQUFQO0FBRUQ7O0FBQ0QsV0FBTyx3QkFBWSx3Q0FBWixDQUFQO0FBQ0Q7O0FBRUQsUUFBTWxDLEdBQU4sR0FBYTtBQUNYLFdBQU8sZ0xBQVA7QUFDRDs7QUFiK0Q7OztBQWVsRVgsTUFBTSxDQUFDWSxJQUFQLENBQVksSUFBSStCLHVDQUFKLEVBQVo7ZUFPZTNDLE0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBvaywgbm9rLCBva09wdGlvbmFsLCBub2tPcHRpb25hbCwgYXV0aG9yaXplSW9zLCByZXNvbHZlRXhlY3V0YWJsZVBhdGggfSBmcm9tICcuL3V0aWxzJzsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuaW1wb3J0IHsgZnMgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCB7IERvY3RvckNoZWNrLCBGaXhTa2lwcGVkRXJyb3IgfSBmcm9tICcuL2RvY3Rvcic7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCBDYXJ0aGFnZURldGVjdG9yIGZyb20gJy4vY2FydGhhZ2UtZGV0ZWN0b3InO1xuaW1wb3J0IHsgZml4SXQgfSBmcm9tICcuL3Byb21wdCc7XG5pbXBvcnQgRW52VmFyQW5kUGF0aENoZWNrIGZyb20gJy4vZW52JztcbmltcG9ydCB7IEVPTCB9IGZyb20gJ29zJztcblxuXG5sZXQgY2hlY2tzID0gW107XG5sZXQgZml4ZXMgPSB7fTtcblxuLy8gQ2hlY2sgZm9yIFhjb2RlLlxuY2xhc3MgWGNvZGVDaGVjayBleHRlbmRzIERvY3RvckNoZWNrIHtcbiAgYXN5bmMgZGlhZ25vc2UgKCkge1xuICAgIGxldCB4Y29kZVBhdGg7XG4gICAgdHJ5IHtcbiAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vYXBwaXVtL2lzc3Vlcy8xMjA5MyNpc3N1ZWNvbW1lbnQtNDU5MzU4MTIwIGNhbiBoYXBwZW5cbiAgICAgIGF3YWl0IGV4ZWMoJ3hjcnVuJywgWydzaW1jdGwnLCAnaGVscCddKTtcblxuICAgICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKCd4Y29kZS1zZWxlY3QnLCBbJy1wJ10pO1xuICAgICAgeGNvZGVQYXRoID0gKHN0ZG91dCB8fCAnJykucmVwbGFjZSgnXFxuJywgJycpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgcmV0dXJuIG5vaygnWGNvZGUgaXMgTk9UIGluc3RhbGxlZCEnKTtcbiAgICB9XG4gICAgcmV0dXJuIHhjb2RlUGF0aCAmJiBhd2FpdCBmcy5leGlzdHMoeGNvZGVQYXRoKSA/IG9rKGBYY29kZSBpcyBpbnN0YWxsZWQgYXQ6ICR7eGNvZGVQYXRofWApIDpcbiAgICAgIG5vayhgWGNvZGUgY2Fubm90IGJlIGZvdW5kIGF0ICcke3hjb2RlUGF0aH0nIWApO1xuICB9XG5cbiAgYXN5bmMgZml4ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgcmV0dXJuIFwiTWFudWFsbHkgaW5zdGFsbCBYY29kZSwgYW5kIG1ha2Ugc3VyZSAneGNvZGUtc2VsZWN0IC1wJyBjb21tYW5kIHNob3dzIHByb3BlciBwYXRoIGxpa2UgJy9BcHBsaWNhdGlvbnMvWGNvZGUuYXBwL0NvbnRlbnRzL0RldmVsb3BlcidcIjtcbiAgfVxufVxuY2hlY2tzLnB1c2gobmV3IFhjb2RlQ2hlY2soKSk7XG5cbi8vIENoZWNrIGZvciBYY29kZSBDb21tYW5kIExpbmUgVG9vbHMuXG5jbGFzcyBYY29kZUNtZExpbmVUb29sc0NoZWNrIGV4dGVuZHMgRG9jdG9yQ2hlY2sge1xuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgc3VwZXIoe2F1dG9maXg6IHRydWV9KTtcbiAgfVxuXG4gIGFzeW5jIGRpYWdub3NlICgpIHtcbiAgICBjb25zdCBlcnJNZXNzID0gJ1hjb2RlIENvbW1hbmQgTGluZSBUb29scyBhcmUgTk9UIGluc3RhbGxlZCEnO1xuICAgIHRyeSB7XG4gICAgICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xNTM3MTkyNS9ob3ctdG8tY2hlY2staWYtY29tbWFuZC1saW5lLXRvb2xzLWlzLWluc3RhbGxlZFxuICAgICAgY29uc3Qgc3Rkb3V0ID0gKGF3YWl0IGV4ZWMoJ3hjb2RlLXNlbGVjdCcsIFsnLXAnXSkpLnN0ZG91dDtcbiAgICAgIHJldHVybiBvayhgWGNvZGUgQ29tbWFuZCBMaW5lIFRvb2xzIGFyZSBpbnN0YWxsZWQgaW46ICR7c3Rkb3V0LnRyaW0oKX1gKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy5kZWJ1ZyhlcnIpO1xuICAgICAgcmV0dXJuIG5vayhlcnJNZXNzKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBmaXggKCkge1xuICAgIGxvZy5pbmZvKGBUaGUgZm9sbG93aW5nIGNvbW1hbmQgbmVlZCBiZSBleGVjdXRlZDogeGNvZGUtc2VsZWN0IC0taW5zdGFsbGApO1xuICAgIGxldCB5ZXNubyA9IGF3YWl0IGZpeEl0KCk7XG4gICAgaWYgKHllc25vID09PSAneWVzJykge1xuICAgICAgYXdhaXQgZXhlYygneGNvZGUtc2VsZWN0JywgWyctLWluc3RhbGwnXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZy5pbmZvKCdTa2lwcGluZyB5b3Ugd2lsbCBuZWVkIHRvIGluc3RhbGwgWGNvZGUgbWFudWFsbHkuJyk7XG4gICAgICB0aHJvdyBuZXcgRml4U2tpcHBlZEVycm9yKCk7XG4gICAgfVxuICB9XG59XG5cbmNoZWNrcy5wdXNoKG5ldyBYY29kZUNtZExpbmVUb29sc0NoZWNrKCkpO1xuXG4vLyBBdXRvbWF0aWNhbGx5IHJ1biBhdXRob3JpemUgaU9TIGlmIHJlcXVlc3RlZFxuZml4ZXMuYXV0aG9yaXplSW9zRml4ID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBsb2cuaW5mbyhgVGhlIGF1dGhvcml6ZSBpT1Mgc2NyaXB0IG5lZWQgdG8gYmUgcnVuLmApO1xuICBsZXQgeWVzbm8gPSBhd2FpdCBmaXhJdCgpO1xuICBpZiAoeWVzbm8gPT09ICd5ZXMnKSB7XG4gICAgYXdhaXQgYXV0aG9yaXplSW9zKCk7XG4gIH0gZWxzZSB7XG4gICAgbG9nLmluZm8oJ1NraXBwaW5nIHlvdSB3aWxsIG5lZWQgdG8gcnVuIHRoZSBhdXRob3JpemUgaU9TIG1hbnVhbGx5LicpO1xuICAgIHRocm93IG5ldyBGaXhTa2lwcGVkRXJyb3IoKTtcbiAgfVxufTtcblxuLy8gRGV2IFRvb2xzIFNlY3VyaXR5XG5jbGFzcyBEZXZUb29sc1NlY3VyaXR5Q2hlY2sgZXh0ZW5kcyBEb2N0b3JDaGVjayB7XG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICBzdXBlcih7YXV0b2ZpeDogdHJ1ZX0pO1xuICB9XG5cbiAgYXN5bmMgZGlhZ25vc2UgKCkge1xuICAgIGNvbnN0IGVyck1lc3MgPSAnRGV2VG9vbHNTZWN1cml0eSBpcyBOT1QgZW5hYmxlZCEnO1xuICAgIGxldCBzdGRvdXQ7XG4gICAgdHJ5IHtcbiAgICAgIHN0ZG91dCA9IChhd2FpdCBleGVjKCdEZXZUb29sc1NlY3VyaXR5JywgW10pKS5zdGRvdXQ7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cuZGVidWcoZXJyKTtcbiAgICAgIHJldHVybiBub2soZXJyTWVzcyk7XG4gICAgfVxuICAgIHJldHVybiBzdGRvdXQgJiYgc3Rkb3V0Lm1hdGNoKC9lbmFibGVkLykgPyBvaygnRGV2VG9vbHNTZWN1cml0eSBpcyBlbmFibGVkLicpXG4gICAgICA6IG5vayhlcnJNZXNzKTtcbiAgfVxuICBhc3luYyBmaXggKCkge1xuICAgIHJldHVybiBhd2FpdCBmaXhlcy5hdXRob3JpemVJb3NGaXgoKTtcbiAgfVxufVxuY2hlY2tzLnB1c2gobmV3IERldlRvb2xzU2VjdXJpdHlDaGVjaygpKTtcblxuLy8gQXV0aG9yaXphdGlvbiBEQlxuY2xhc3MgQXV0aG9yaXphdGlvbkRiQ2hlY2sgZXh0ZW5kcyBEb2N0b3JDaGVjayB7XG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICBzdXBlcih7YXV0b2ZpeDogdHJ1ZX0pO1xuICB9XG5cbiAgYXN5bmMgZGlhZ25vc2UgKCkge1xuICAgIGNvbnN0IHN1Y2Nlc3NNZXNzID0gJ1RoZSBBdXRob3JpemF0aW9uIERCIGlzIHNldCB1cCBwcm9wZXJseS4nO1xuICAgIGNvbnN0IGVyck1lc3MgPSAnVGhlIEF1dGhvcml6YXRpb24gREIgaXMgTk9UIHNldCB1cCBwcm9wZXJseS4nO1xuICAgIGxldCBzdGRvdXQ7XG4gICAgdHJ5IHtcbiAgICAgICh7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ3NlY3VyaXR5JywgWydhdXRob3JpemF0aW9uZGInLCAncmVhZCcsICdzeXN0ZW0ucHJpdmlsZWdlLnRhc2twb3J0J10pKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy53YXJuKGVycik7XG4gICAgICByZXR1cm4gbm9rKGVyck1lc3MpO1xuICAgIH1cbiAgICByZXR1cm4gc3Rkb3V0ICYmIChzdGRvdXQubWF0Y2goL2lzLWRldmVsb3Blci8pIHx8IHN0ZG91dC5tYXRjaCgvYWxsb3cvKSkgP1xuICAgICAgb2soc3VjY2Vzc01lc3MpIDogbm9rKGVyck1lc3MpO1xuICB9XG4gIGFzeW5jIGZpeCAoKSB7XG4gICAgcmV0dXJuIGF3YWl0IGZpeGVzLmF1dGhvcml6ZUlvc0ZpeCgpO1xuICB9XG59XG5jaGVja3MucHVzaChuZXcgQXV0aG9yaXphdGlvbkRiQ2hlY2soKSk7XG5cbi8vIENoZWNrIGZvciBDYXJ0aGFnZSAoZm9yIFdEQSlcbmNsYXNzIENhcnRoYWdlQ2hlY2sgZXh0ZW5kcyBEb2N0b3JDaGVjayB7XG4gIGFzeW5jIGRpYWdub3NlICgpIHtcbiAgICBsZXQgY2FydGhhZ2VQYXRoID0gYXdhaXQgQ2FydGhhZ2VEZXRlY3Rvci5kZXRlY3QoKTtcbiAgICByZXR1cm4gY2FydGhhZ2VQYXRoXG4gICAgICA/IG9rKGBDYXJ0aGFnZSB3YXMgZm91bmQgYXQ6ICR7Y2FydGhhZ2VQYXRofWApXG4gICAgICA6IG5vayhgQ2FydGhhZ2Ugd2FzIE5PVCBmb3VuZCFgKTtcbiAgfVxuXG4gIGFzeW5jIGZpeCAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIHJldHVybiAnUGxlYXNlIGluc3RhbGwgQ2FydGhhZ2UuIFZpc2l0IGh0dHBzOi8vZ2l0aHViLmNvbS9DYXJ0aGFnZScgK1xuICAgICAgICAgICAnL0NhcnRoYWdlI2luc3RhbGxpbmctY2FydGhhZ2UgZm9yIG1vcmUgaW5mb3JtYXRpb24uJztcbiAgfVxufVxuY2hlY2tzLnB1c2gobmV3IENhcnRoYWdlQ2hlY2soKSk7XG5cbmNoZWNrcy5wdXNoKG5ldyBFbnZWYXJBbmRQYXRoQ2hlY2soJ0hPTUUnKSk7XG5cbmNsYXNzIE9wdGlvbmFsRmJzaW1jdGxDb21tYW5kQ2hlY2sgZXh0ZW5kcyBEb2N0b3JDaGVjayB7XG4gIGFzeW5jIGRpYWdub3NlICgpIHtcbiAgICBjb25zdCBmYnNpbWN0bFBhdGggPSBhd2FpdCByZXNvbHZlRXhlY3V0YWJsZVBhdGgoJ2Zic2ltY3RsJyk7XG4gICAgaWYgKGZic2ltY3RsUGF0aCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZmJzaW1jdGxWZXJzaW9uID0gKGF3YWl0IGV4ZWMoJ2JyZXcnLCBbJ2xpc3QnLCAnLS12ZXJzaW9ucycsICdmYnNpbWN0bCddKSkuc3Rkb3V0LnRyaW0oKTtcbiAgICAgICAgcmV0dXJuIG9rT3B0aW9uYWwoYGZic2ltY3RsIGlzIGluc3RhbGxlZCBhdDogJHtmYnNpbWN0bFBhdGh9LiBJbnN0YWxsZWQgdmVyc2lvbnMgYXJlOiAke2Zic2ltY3RsVmVyc2lvbn1gKTtcbiAgICAgIH0gY2F0Y2gge1xuICAgICAgICByZXR1cm4gb2tPcHRpb25hbChgZmJzaW1jdGwgaXMgaW5zdGFsbGVkIGF0OiAke2Zic2ltY3RsUGF0aH0uIEl0IGlzIHByYmFibHkgaW5zdGFsbGVkIGFzIGN1c3RvbSBpbnN0YWxsLmApO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBub2tPcHRpb25hbCgnZmJzaW1jdGwgY2Fubm90IGJlIGZvdW5kJyk7XG4gIH1cblxuICBhc3luYyBmaXggKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICByZXR1cm4gJ1doeSBmYnNpbWN0bCBpcyBuZWVkZWQgYW5kIGhvdyB0byBpbnN0YWxsIGl0OiBodHRwOi8vYXBwaXVtLmlvL2RvY3MvZW4vZHJpdmVycy9pb3MteGN1aXRlc3QvJztcbiAgfVxufVxuY2hlY2tzLnB1c2gobmV3IE9wdGlvbmFsRmJzaW1jdGxDb21tYW5kQ2hlY2soKSk7XG5cbmNsYXNzIE9wdGlvbmFsQXBwbGVzaW11dGlsc0NvbW1hbmRDaGVjayBleHRlbmRzIERvY3RvckNoZWNrIHtcbiAgYXN5bmMgZGlhZ25vc2UgKCkge1xuICAgIGNvbnN0IGFwcGxlc2ltdXRpbHNQYXRoID0gYXdhaXQgcmVzb2x2ZUV4ZWN1dGFibGVQYXRoKCdhcHBsZXNpbXV0aWxzJyk7XG4gICAgcmV0dXJuIGFwcGxlc2ltdXRpbHNQYXRoXG4gICAgICA/IG9rT3B0aW9uYWwoYGFwcGxlc2ltdXRpbHMgaXMgaW5zdGFsbGVkIGF0OiAke2FwcGxlc2ltdXRpbHNQYXRofS4gSW5zdGFsbGVkIHZlcnNpb25zIGFyZTogJHsoYXdhaXQgZXhlYygnYnJldycsIFsnbGlzdCcsICctLXZlcnNpb25zJywgJ2FwcGxlc2ltdXRpbHMnXSkpLnN0ZG91dC50cmltKCl9YClcbiAgICAgIDogbm9rT3B0aW9uYWwoJ2FwcGxlc2ltdXRpbHMgY2Fubm90IGJlIGZvdW5kJyk7XG4gIH1cblxuICBhc3luYyBmaXggKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICByZXR1cm4gJ1doeSBhcHBsZXNpbXV0aWxzIGlzIG5lZWRlZCBhbmQgaG93IHRvIGluc3RhbGwgaXQ6IGh0dHA6Ly9hcHBpdW0uaW8vZG9jcy9lbi9kcml2ZXJzL2lvcy14Y3VpdGVzdC8nO1xuICB9XG59XG5jaGVja3MucHVzaChuZXcgT3B0aW9uYWxBcHBsZXNpbXV0aWxzQ29tbWFuZENoZWNrKCkpO1xuXG5jbGFzcyBPcHRpb25hbElkZXZpY2Vsb2NhdGlvbkNvbW1hbmRDaGVjayBleHRlbmRzIERvY3RvckNoZWNrIHtcbiAgYXN5bmMgZGlhZ25vc2UgKCkge1xuICAgIGNvbnN0IGlkZXZpY2Vsb2NhdGlvblBhdGggPSBhd2FpdCByZXNvbHZlRXhlY3V0YWJsZVBhdGgoJ2lkZXZpY2Vsb2NhdGlvbicpO1xuICAgIHJldHVybiBpZGV2aWNlbG9jYXRpb25QYXRoXG4gICAgICA/IG9rT3B0aW9uYWwoYGlkZXZpY2Vsb2NhdGlvbiBpcyBpbnN0YWxsZWQgYXQ6ICR7aWRldmljZWxvY2F0aW9uUGF0aH1gKVxuICAgICAgOiBub2tPcHRpb25hbCgnaWRldmljZWxvY2F0aW9uIGNhbm5vdCBiZSBmb3VuZCcpO1xuICB9XG5cbiAgYXN5bmMgZml4ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgcmV0dXJuICdpZGV2aWNlbG9jYXRpb24gaXMgdXNlZCB0byBzZXQgZ2VvbG9jYXRpb24gZm9yIHJlYWwgZGV2aWNlLiBQbGVhc2UgcmVhZCBodHRwczovL2dpdGh1Yi5jb20vSm9uR2FiaWxvbmRvQW5ndWxvL2lkZXZpY2Vsb2NhdGlvbiB0byBpbnN0YWxsIGl0JztcbiAgfVxufVxuY2hlY2tzLnB1c2gobmV3IE9wdGlvbmFsSWRldmljZWxvY2F0aW9uQ29tbWFuZENoZWNrKCkpO1xuXG5jbGFzcyBPcHRpb25hbElPU0RlcGxveUNvbW1hbmRDaGVjayBleHRlbmRzIERvY3RvckNoZWNrIHtcbiAgYXN5bmMgZGlhZ25vc2UgKCkge1xuICAgIGNvbnN0IGlvc0RlcGxveVBhdGggPSBhd2FpdCByZXNvbHZlRXhlY3V0YWJsZVBhdGgoJ2lvcy1kZXBsb3knKTtcbiAgICByZXR1cm4gaW9zRGVwbG95UGF0aFxuICAgICAgPyBva09wdGlvbmFsKGBpb3MtZGVwbG95IGlzIGluc3RhbGxlZCBhdDogJHtpb3NEZXBsb3lQYXRofS4gSW5zdGFsbGVkIHZlcnNpb24gaXM6ICR7KGF3YWl0IGV4ZWMoaW9zRGVwbG95UGF0aCwgWyctViddKSkuc3Rkb3V0LnRyaW0oKX1gKVxuICAgICAgOiBub2tPcHRpb25hbCgnaW9zLWRlcGxveSBjYW5ub3QgYmUgZm91bmQnKTtcbiAgfVxuXG4gIGFzeW5jIGZpeCAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIHJldHVybiAnaW9zLWRlcGxveSBpcyB1c2VkIHRvIGluc3RhbGwgaU9TIGFwcGxpY2F0aW9ucyB0byByZWFsIGRldmljZS4gUGxlYXNlIHJlYWQgaHR0cDovL2FwcGl1bS5pby9kb2NzL2VuL2RyaXZlcnMvaW9zLXhjdWl0ZXN0LXJlYWwtZGV2aWNlcy8gdG8gaW5zdGFsbCBpdCc7XG4gIH1cbn1cbmNoZWNrcy5wdXNoKG5ldyBPcHRpb25hbElPU0RlcGxveUNvbW1hbmRDaGVjaygpKTtcblxuY2xhc3MgT3B0aW9uYWxJT1NXZWJraXREZWJ1Z1Byb3h5Q29tbWFuZENoZWNrIGV4dGVuZHMgRG9jdG9yQ2hlY2sge1xuICBhc3luYyBkaWFnbm9zZSAoKSB7XG4gICAgY29uc3QgaW9zV2Via2l0RGVidWdQcm94eVBhdGggPSBhd2FpdCByZXNvbHZlRXhlY3V0YWJsZVBhdGgoJ2lvc193ZWJraXRfZGVidWdfcHJveHknKTtcbiAgICBpZiAoaW9zV2Via2l0RGVidWdQcm94eVBhdGgpIHtcbiAgICAgIGNvbnN0IHZlcnNpb24gPSAoYXdhaXQgZXhlYyhpb3NXZWJraXREZWJ1Z1Byb3h5UGF0aCwgWyctViddKSkuc3Rkb3V0LnNwbGl0KEVPTCk7XG4gICAgICByZXR1cm4gb2tPcHRpb25hbChgaW9zX3dlYmtpdF9kZWJ1Z19wcm94eSBpcyBpbnN0YWxsZWQgYXQ6ICR7aW9zV2Via2l0RGVidWdQcm94eVBhdGh9LiBJbnN0YWxsZWQgdmVyc2lvbiBpczogJHtcbiAgICAgICAgdmVyc2lvblswXS5yZXBsYWNlKCdpb3Nfd2Via2l0X2RlYnVnX3Byb3h5ICcsICcnKX0sICR7dmVyc2lvblsxXX1gKTtcbiAgICB9XG4gICAgcmV0dXJuIG5va09wdGlvbmFsKCdpb3Nfd2Via2l0X2RlYnVnX3Byb3h5IGNhbm5vdCBiZSBmb3VuZCcpO1xuICB9XG5cbiAgYXN5bmMgZml4ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgcmV0dXJuICdpb3Nfd2Via2l0X2RlYnVnX3Byb3h5IGlzIHVzZWQgdG8gcHJveHkgcmVxdWV0cyBmcm9tIEFwcGl1bSB0byBNb2JpbGVTYWZhcmkgcnVubmluZyBvbiByZWFsIGRldmljZS4gUGxlYXNlIHJlYWQgaHR0cHM6Ly9naXRodWIuY29tL2dvb2dsZS9pb3Mtd2Via2l0LWRlYnVnLXByb3h5IHRvIGluc3RhbGwgaXQnO1xuICB9XG59XG5jaGVja3MucHVzaChuZXcgT3B0aW9uYWxJT1NXZWJraXREZWJ1Z1Byb3h5Q29tbWFuZENoZWNrKCkpO1xuXG5leHBvcnQge1xuICBmaXhlcywgWGNvZGVDaGVjaywgWGNvZGVDbWRMaW5lVG9vbHNDaGVjaywgRGV2VG9vbHNTZWN1cml0eUNoZWNrLFxuICBBdXRob3JpemF0aW9uRGJDaGVjaywgQ2FydGhhZ2VDaGVjaywgT3B0aW9uYWxGYnNpbWN0bENvbW1hbmRDaGVjaywgT3B0aW9uYWxBcHBsZXNpbXV0aWxzQ29tbWFuZENoZWNrLCBPcHRpb25hbElkZXZpY2Vsb2NhdGlvbkNvbW1hbmRDaGVjayxcbiAgT3B0aW9uYWxJT1NEZXBsb3lDb21tYW5kQ2hlY2ssIE9wdGlvbmFsSU9TV2Via2l0RGVidWdQcm94eUNvbW1hbmRDaGVja1xufTtcbmV4cG9ydCBkZWZhdWx0IGNoZWNrcztcbiJdLCJmaWxlIjoibGliL2lvcy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
